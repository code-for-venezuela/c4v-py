name: Publish Python to PyPi

on: 
  push:
    branches:
      - luis/ci-config #CHANGE ME TO MASTER ONCE THIS IS PROPERLY TESTED
      
jobs:
  build-n-publish:
    name: Build and publish c4v-py package
    runs-on: ubuntu-18.04
    steps:
    - name: Set up Python 3.8.10
      uses: actions/setup-python@v1
      with:
        python-version: 3.8.10
        
    - name: Install requirements
      run: |-
        python3 -m pip install --upgrade pip
        python3 -m pip install packaging
        cat requirements.txt
        python3 -m pip install -r ./requirements.txt
        
    - name: Build & publish with Poetry
      run: |- 
        poetry build
        poetry publish --username c4v --password ${{ secrets.C4VPY_PYPI_PASSWORD }}
