name: Publish Python to PyPi

on: 
  push:
    branches:
      - luis/ci-config #CHANGE ME TO MASTER ONCE THIS IS PROPERLY TESTED
      
jobs:
  build-n-publish:
    name: Build and publish c4v-py package
    runs-on: ubuntu-18.04
    steps:
    - name: Setup Python
      uses: actions/setup-python@v2.2.2
      with:
        # Version range or exact version of a Python version to use, using SemVer's version range syntax.
        python-version: 3.8
    - uses: actions/checkout@master
    
    - name: Set up Python 3.8.1
      uses: actions/setup-python@v1
      with:
        python-version: 3.8.1
        
    - name: Install requirements
      run: >-
        python -m
        pip install -r requirements.txt
        
    - name: Build & publish with Poetry
      run: >- 
        poetry build
        poetry publish --username c4v --password ${{ secrets.C4VPY_PYPI_PASSWORD }}
